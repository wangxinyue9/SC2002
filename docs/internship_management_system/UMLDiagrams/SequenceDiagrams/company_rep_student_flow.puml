@startuml
title Student â€“ Opportunity Discovery & Application Flow

actor ":Student\n<<actor>>" as StudentUser
participant "oppList:InternshipOpportunityList\n<<boundary>>" as OppList
participant "state:UIState\n<<entity>>" as UIState
database "ds:DataStorage\n<<entity>>" as DataStorage
entity "opp:InternshipOpportunity\n<<entity>>" as Opportunity
participant "studOpp:StudentOpportunityScreen\n<<boundary>>" as StudentOpp
participant "studApp:StudentApplicationScreen\n<<boundary>>" as StudentApp
entity "app:InternshipApplication\n<<entity>>" as Application

== Filtered Opportunity Listing ==
StudentUser -> OppList: show(uiState)
activate OppList
OppList -> UIState: load student filter preferences
note over OppList
Student filters enforce:
- Only APPROVED opportunities
- Must be marked visible
- Preferred major matches student.major
- Year 1-2: BASIC level only
- Year 3+: all levels
end note
OppList -> DataStorage: getInternshipOpportunities(student filters)
activate DataStorage
DataStorage --> OppList: filtered list
deactivate DataStorage

alt no matching postings
    OppList -> StudentUser: show empty list
    deactivate OppList
    return
else matches found
    StudentUser -> OppList: pick opportunity
    OppList -> UIState: setCurrentOpportunity(selected)
    OppList --> StudentOpp: transition
end
deactivate OppList

== Opportunity Details & Application ==
activate StudentOpp
StudentOpp -> DataStorage: getInternshipApplicationForAnOpportunity(opp, student)
DataStorage --> StudentOpp: Optional<Application>
alt already applied
    StudentOpp -> StudentUser: offer "View your application"
    StudentUser -> StudentOpp: choose view
    StudentOpp -> UIState: setCurrentApplication(existing)
    StudentOpp --> StudentApp: transition
else opportunity open & student eligible
    StudentOpp -> StudentUser: show "Apply" option
    StudentUser -> StudentOpp: confirm apply
    StudentOpp -> DataStorage: newInternshipApplication(opp, student)
    DataStorage --> StudentOpp: Application
    StudentOpp -> UIState: setCurrentApplication(Application)
    StudentOpp --> StudentApp: transition
else not eligible (e.g., filled or student accepted elsewhere)
    StudentOpp -> StudentUser: show message + back
    deactivate StudentOpp
    return
end
deactivate StudentOpp

== Application Follow-up ==
activate StudentApp
StudentApp -> StudentUser: display status/withdraw/accept options
opt Offer received (status == SUCCESSFUL)
    StudentUser -> StudentApp: Accept placement
    StudentApp -> Application: confirmPlacement(true)
    Application -> Opportunity: takeUpASlot()
    note right of StudentApp
    DataStorage then withdraws other active offers for the student.
    end note
end
opt Withdraw request
    StudentUser -> StudentApp: Request withdrawal / confirm withdraw update
    StudentApp -> Application: requestWithdraw()/confirmWithdraw(...)
end
StudentApp --> StudentUser: return to application list
deactivate StudentApp

@enduml
